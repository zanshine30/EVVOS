#!/bin/bash
# Quick fix for the pvrhino.RHINO_VERSION AttributeError

echo "Stopping evvos-pico-voice service..."
sudo systemctl stop evvos-pico-voice

echo "Creating fixed service file..."
sudo python3 << 'PYTHON_FIX'
# Read the service file
with open('/usr/local/bin/evvos-pico-voice-service.py', 'r') as f:
    content = f.read()

# Fix the RHINO_VERSION line
content = content.replace(
    'logger.info(f"PicoVoice Rhino: {pvrhino.RHINO_VERSION}")',
    '''try:
        logger.info(f"PicoVoice Rhino: {pvrhino.RHINO_VERSION}")
    except AttributeError:
        logger.info("PicoVoice Rhino: Installed")'''
)

# Also fix the version property in setup_rhino if it exists
content = content.replace(
    'logger.info(f"  Version: {self.rhino.version}")',
    '''try:
            logger.info(f"  Version: {self.rhino.version}")
        except AttributeError:
            logger.info(f"  Version: Not available")'''
)

# Write the fixed version
with open('/usr/local/bin/evvos-pico-voice-service.py', 'w') as f:
    f.write(content)

print("Service file fixed!")
PYTHON_FIX

echo "Restarting service..."
sudo systemctl restart evvos-pico-voice

echo ""
echo "âœ“ Fix applied!"
echo ""
echo "Check the logs with:"
echo "  sudo journalctl -u evvos-pico-voice -f"
echo ""
