#!/bin/bash
# Manual fix for IndentationError

echo "Stopping service..."
sudo systemctl stop evvos-pico-voice

echo "Fixing line 171..."
sudo python3 << 'PYTHONFIX'
import sys

# Read file
with open('/usr/local/bin/evvos-pico-voice-service.py', 'r') as f:
    lines = f.readlines()

# Find and fix the problematic line (around line 171)
for i, line in enumerate(lines):
    if 'pvrhino.RHINO_VERSION' in line:
        # Replace with simple version
        lines[i] = '        logger.info("PicoVoice Rhino: Installed")\n'
        print(f"Fixed line {i+1}")
    
    # Also fix the self.rhino.version line if it exists
    if 'self.rhino.version' in line and 'Version:' in line:
        lines[i] = '            logger.info("  Version: Installed")\n'
        print(f"Fixed line {i+1}")

# Write back
with open('/usr/local/bin/evvos-pico-voice-service.py', 'w') as f:
    f.writelines(lines)

print("File fixed successfully!")
PYTHONFIX

echo "Restarting service..."
sudo systemctl restart evvos-pico-voice

sleep 2

echo ""
echo "âœ“ Service restarted!"
echo ""
echo "Check status:"
echo "  sudo systemctl status evvos-pico-voice"
echo ""
echo "View logs:"
echo "  sudo journalctl -u evvos-pico-voice -f"
