#!/bin/bash
# The simplest fix - directly edit the file

echo "Identation Error, stopping service..."
sudo systemctl stop evvos-pico-voice

echo "Backing up original file..."
sudo cp /usr/local/bin/evvos-pico-voice-service.py /usr/local/bin/evvos-pico-voice-service.py.broken

echo "Fixing the service file..."

# This sed command removes lines 171-174 which contain the broken try block
# and replaces with a simple logger statement
sudo sed -i '171,174d' /usr/local/bin/evvos-pico-voice-service.py
sudo sed -i '170a\        logger.info("PicoVoice Rhino: Installed")' /usr/local/bin/evvos-pico-voice-service.py

echo "Restarting service..."
sudo systemctl restart evvos-pico-voice

sleep 2

echo ""
echo "âœ“ Fixed!"
echo ""
echo "Check status:"
sudo systemctl status evvos-pico-voice --no-pager | head -20
echo ""
echo "View logs:"
echo "  sudo journalctl -u evvos-pico-voice -f"
